name: Update Flake Lock

on:
  workflow_dispatch: # Allow manual trigger
  schedule:
    # Run every Monday at 9:00 AM UTC
    - cron: '0 9 * * 1'

jobs:
  update-flake-lock:
    name: Update flake.lock
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Nix
        uses: cachix/install-nix-action@v27
        with:
          extra_nix_config: |
            experimental-features = nix-command flakes
            accept-flake-config = true

      - name: Update flake.lock
        uses: DeterminateSystems/update-flake-lock@v24
        with:
          pr-title: 'chore: update flake.lock'
          pr-labels: |
            dependencies
            automated
          commit-msg: 'chore: update flake inputs'
          pr-body: |
            Automated flake.lock update

            This PR updates the flake.lock file to the latest versions of all inputs.

            Please review the changes and ensure that:
            - [ ] All checks pass
            - [ ] No breaking changes are introduced
            - [ ] The configuration still builds successfully

            To test locally:
            ```bash
            nix flake check
            just switch  # or nixos-rebuild switch --flake .#<host>
            ```
